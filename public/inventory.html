<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Inventory System</title>
    <link rel="stylesheet" href="sty.css">
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin-top: 20px; }
        input, select, button { margin: 5px; padding: 8px; }
        table { width: 80%; margin: auto; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 10px; border: 1px solid black; text-align: center; }
        th { background-color: #4CAF50; color: white; }
        button { cursor: pointer; }
        .delete-btn { background: red; color: white; border: none; padding: 5px 10px; }
        .delete-btn:hover { background: darkred; }
    </style>
</head>
<body>

    <script type="module">
        // Import Firebase functions
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
        import { getDatabase, ref, set, push, child, onValue } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-database.js";

        // ðŸ”¹ Your Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCwjFQXSwBsAPGCaUOlm-VWb28QTQKdeWM",
            authDomain: "stockmaintainence-dabe5.firebaseapp.com",
            databaseURL: "https://stockmaintainence-dabe5-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "stockmaintainence-dabe5",
            storageBucket: "stockmaintainence-dabe5.appspot.com",
            messagingSenderId: "43533671684",
            appId: "1:43533671684:web:d7025dc879ddf16a590451",
            measurementId: "G-TR05GFK3K9"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // Function to add an item to Firebase
        window.addItem = function() {
            const itemName = document.getElementById("itemName").value.trim();
            const stockQuantity = document.getElementById("stockQuantity").value.trim();
            const category = document.getElementById("category").value;

            if (!itemName || !stockQuantity) {
                alert("Please enter item name and stock quantity!");
                return;
            }

            const newItemRef = push(child(ref(database), "inventory"));
            set(newItemRef, {
                itemName: itemName,
                stockQuantity: parseInt(stockQuantity),
                category: category
            })
            .then(() => {
                alert("Item added successfully!");
                document.getElementById("itemName").value = "";
                document.getElementById("stockQuantity").value = "";
            })
            .catch(error => {
                alert("Error adding item: " + error.message);
            });
        };

        // Function to display items
        function displayItems(items) {
            const inventoryTable = document.getElementById("inventoryTable");
            inventoryTable.innerHTML = ""; // Clear previous items

            items.forEach(item => {
                let row = `<tr>
                    <td>${item.itemName}</td>
                    <td>${item.stockQuantity}</td>
                    <td>${item.category}</td>
                    <td><button class="delete-btn" onclick="deleteItem('${item.id}')">Delete</button></td>
                </tr>`;
                inventoryTable.innerHTML += row;
            });
        }

        // Fetch first 100 items from Firebase in order
        function fetchInventory() {
            const inventoryRef = ref(database, "inventory");
            onValue(inventoryRef, (snapshot) => {
                let items = [];
                snapshot.forEach(childSnapshot => {
                    let item = childSnapshot.val();
                    item.id = childSnapshot.key;
                    items.push(item);
                });

                // Sort by item name (you can change this if needed)
                items.sort((a, b) => a.itemName.localeCompare(b.itemName));

                // Limit to first 100 items
                displayItems(items.slice(0, 100));
            });
        }

        // Function to search inventory
        window.searchInventory = function() {
            const searchValue = document.getElementById("searchBar").value.toLowerCase();
            const rows = document.querySelectorAll("#inventoryTable tr");

            rows.forEach(row => {
                const itemName = row.cells[0].textContent.toLowerCase();
                row.style.display = itemName.includes(searchValue) ? "" : "none";
            });
        };

        // Fetch inventory on page load
        window.onload = fetchInventory;
    </script>

    <!-- Sidebar Container -->
    <div id="sidebar-container"></div>
    <script>
        // Load sidebar dynamically
        fetch("sidebar.html")
            .then(response => response.text())
            .then(data => {
                document.getElementById("sidebar-container").innerHTML = data;

                // Highlight active sidebar link
                const currentPage = window.location.pathname.split("/").pop();
                document.querySelectorAll(".sidebar ul li a").forEach(link => {
                    if (link.getAttribute("href") === currentPage) {
                        link.classList.add("active");
                    }
                });
            })
            .catch(error => console.error("Error loading sidebar:", error));
    </script>

    <div class="container">
        <h2>Stock Inventory Management</h2>

        <input type="text" id="ProductName" placeholder="Product Name">
        <input type="number" id="ProductID" placeholder="Product ID">
        <input type="text" id="supplier" placeholder="Supplier">
        <input type="number" id="cost" placeholder="Cost">
        <select id="Unit">
            <option value="Pieces">Pieces</option>
            <option value="Kgs">Kgs</option>
            <option value="Liters">Liters</option>
            <option value="Carton">Cartons</option>
            <option value="dozen">Dozen</option>
        </select>
        <input type="number" id="currentQuantity" placeholder="Current Quantity">
        <input type="number" id="minimumQuantity" placeholder="Minimum Quantity">
        <input type="number" id="reorderQuantity" placeholder="Reorder Quantity">
        <select id="category">
            <option value="Electronics">Electronics</option>
            <option value="Grocery">Grocery</option>
            <option value="Clothing">Clothing</option>
            <option value="Other">Other</option>
        </select>
        <select id="Status">
            <option value="active">Active</option>
            <option value="Inactive">Inactive</option>
        </select>
        <button onclick="addItem()">Add Item</button>

        <br><br>

        <!-- Search Bar -->
        <input type="text" id="searchBar" placeholder="Search Item..." onkeyup="searchInventory()">

        <table>
            <thead>
                <tr>
                    <th>Item Name</th>
                    <th>Product ID</th>
                    <th>Supplier</th>
                    <th>Cost</th>
                    <th>Unit</th>
                    <th>Current Quantity</th>
                    <th>Minimum Quantity</th>
                    <th>Reorder Quantity</th>
                    <th>Category</th>
                    <th>Status</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="inventoryTable"></tbody>
        </table>
        
    </div>

</body>
</html>
